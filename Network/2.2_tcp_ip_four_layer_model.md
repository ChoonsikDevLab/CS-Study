# 2.2 TCP/IP 4계층 모델

## 2.2.1 계층 구조

TCP/IP 계층과 OSI 계층
- 데이터 통신 과정을 계층으로 나누어 설계한 것이다.
- 각 계층이 독립적으로 작동하며 상위/하위 계층과 상호작용 한다.

<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Application_Layer.png/220px-Application_Layer.png" height="300"/>

### 애플리케이션(application) 계층
응용 프로그램이 네트워크를 통해 데이터를 주고받을 수 있도록 지원한다. <br>
주요 프로토콜: FTP, HTTP, SSH, SMTP, DNS

### 전송(transport) 계층
호스트 간 데이터 전송을 책임지고, 데이터의 신뢰성과 흐름 제어를 보장한다. <br>
주요 프로토콜:
<details>
<summary>TCP</summary>

- 신뢰성 있는 연결형 서비스를 제공한다.
- 가상회선 패킷 교환 방식을 사용한다.
<img src="https://woovictory.github.io/img/virtual_circut_packet.png"/>

- 3-way-handshake
    
    TCP/IP 프로토콜에서 신뢰성 있는 연결을 성립하기 위해 사용하는 3단계 철차이다.
    클라이언트와 서버가 데이터를 교환하기 전 서로 통신 가능 여부를 확인하고, 연결을 설정하는 과정이다.

    **연결 성립 과정**
    1. 클라이언트는 서버에 SYN(A) 패킷을 보낸다.
    2. 서버는 SYN을 수신하고 ACK(A + 1)와 SYN(B)을 보낸다.
    3. 클라이언트는 ACK와 SYN 패킷을 받고 ACK(B + 1)을 서버로 보낸다.
    <img src="https://media.geeksforgeeks.org/wp-content/uploads/TCP-connection-1.png"/>
- 4-way-handshake

    TCP가 연결을 해제할 때 수행되는 절차이다. 

    **연결 해제 과정** 
    1. 클라이언트가 서버에 FIN 세그먼트를 전송하고, FIN_WAIT_1 상태로 전환하여 서버의 응답을 기다린다.
    2. 서버는 클라이언트에 ACK 세그먼트를 전송한다.
    3. 일정시간 이후에 클라이언트에 FIN 세그먼트를 보낸다.
    4. 클라이언트는 TIME_WAIT 상태가 되고, 서버로 ACK를 보내 서버의 연결을 닫는다.
    5. 클라이언트는 일정 시간 대기 후 연결을 닫는다. 
    <img src="https://media.geeksforgeeks.org/wp-content/uploads/CN.png"/>

</details>

<details>
<summary>UDP</summary>
- 비연결형 서비스를 제공한다.
- 데이터그램 패킷 교환 방식을 사용한다.
<img src="https://woovictory.github.io/img/datagram_packet.png"/>
</details>

### 인터넷(internet) 계층
장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송한다. <br>
주요 프로토콜: IP, ICMP, ARP

### 링크(link) 계층
데이터가 실제 네트워크 매체를 통해 전송되도록 처리한다. 
- 물리 계층

    무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터를 보낸다.

- 데이터 링크 계층
    
    이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화 한다.

### 계층 간 데이터 송수신 과정
컴퓨터를 통해 다른 컴퓨터로 데이터를 요청할 때 송수신 과정은 아래와 같다.
1. 애플리케이션 계층에서 전송 계층으로 보내는 요청 값들이 캡슐화 되어 전달
2. 링크 계층을 통해 해당 서버와 통신
3. 해상 서버의 링크 계층으로부터 애플리케이션까지 비캡슐화를 거쳐 전달

<br>

- **캡슐화 과정**: 상위 계층의 헤더와 데이터를 해당 계층의 데이터에 포함시키고 헤더를 삽입하는 과정을 말한다.
- **비캡슐화 과정**: 하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정을 말한다.

## 2.2.2 PDU(Protocol Data Unit)
네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 의미한다.

계층마다 PDU의 명칭이 다르다.

### TCP/IP 4계층과 OSI 7계층의 PDU

| TCP/IP 4계층       | OSI 7계층             | PDU (Protocol Data Unit) |
|--------------------|-----------------------|---------------------------|
| 애플리케이션 계층       | 애플리케이션 계층         | 메시지                      |
|                    | 프레젠테이션 계층          |                       |
|                    | 세션 계층               |                       |
| 전송 계층            | 전송 계층               | 세그먼트(TCP), 데이터그램(UDP)  |
| 인터넷 계층          | 네트워크 계층           | 패킷                    |
| 링크 계층            | 데이터 링크 계층        | 프레임                     |
|                    | 물리 계층            | 비트                       |


<br>

## 예상 질문

<details> 
<summary><b>1. OSI 7계층과 TCP/IP 4계층의 차이점은 무엇인가요?</b></summary>

- OSI 모델은 7계층(물리, 데이터 링크, 네트워크, 전송, 세션, 표현, 응용)으로 구성되고, TCP/IP 모델은 4계층(네트워크 인터페이스, 인터넷, 전송, 응용)으로 구성된다.
- OSI 모델은 개념적 설계와 학습 목적으로 만들어진 참조 모델이고, TCP/IP는 실제 네트워크에서 동작하는 프로토콜 스택이다.
- TCP/IP는 실질적인 구현을 기반으로 하며, OSI는 이론적인 프레임워크를 제공한다.

</details>

<br>

<details> 
<summary><b>2. TCP와 UDP의 차이에 대해서 설명해주세요.</b></summary>

TCP
- 연결 설정을 통해 통신을 시작한다.
- 패킷의 순서와 무결성을 확인하며, 손실된 패킷은 재전송한다.
- 신뢰성 보장 때문에 속도가 느리다.

UDP
- 연결 설정 과정이 없어 TCP보다 속도가 빠르다.
- 패킷의 순서나 무결성을 확인하지 않는다.

</details>

<br>

<details> 
<summary><b>3. 3 way-handshake와 4 way-handshake 과정에 대해 설명해주세요.</b></summary>

**3-way handshake**: 통신할 네트워크 장치 간 논리적 접속 상태를 만들기 위해 사용한다.
1. 클라이언트가 서버로 SYN(연결 요청)을 보낸다.
2. 서버가 클라이언트에게 SYN + ACK(연결 요청 수락 및 응답)를 보낸다.
3. 클라이언트가 서버에게 ACK(연결 확인)를 보낸다.

<br>

**4-way handshake**: 데이터 유실을 방지하며 연결을 해제하기 위해 사용한다.
1. 클라이언트가 서버로 FIN(연결 종료 요청)을 보낸다.
2. 서버가 클라이언트에게 ACK(종료 요청 수락)를 보낸다.
3. 서버가 클라이언트에게 FIN(종료 요청)을 보낸다.
4. 클라이언트가 서버에게 ACK(종료 확인)를 보낸다.

</details>
